<!DOCTYPE html>
<html>
  <head>
    <title>IPS-DEV</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" type="text/css" href="core/fonts/mono.css"> 
    <link rel="stylesheet" type="text/css" href="core/css/animate.css"> 
    <link rel="stylesheet" type="text/css" href="core/css/cinescript.css"> 
    <link rel="stylesheet" type="text/css" href="core/css/style_core.css"> 
    <link rel="stylesheet" type="text/css" href="core/css/mermaid.css"> 
    <link rel="stylesheet" type="text/css" href="core/css/gitgraph.css"> 
    <link rel="stylesheet" type="text/css" href="core/css/style_ensiie.css"> 
  </head>
  <body>
    <textarea id="source" readonly>
class: titlepage

.title[
Introduction to Scientific Programming
]

.subtitle[
IPS-DEV - N. Dubray - ENSIIE - 2017
]

.row[
`$$\int_{-\infty}^\infty f(x)e^{-x^2} dx \simeq \sum_{i=0}^{n-1}w_if(x_i)$$`
]

???

[back to TOC](../toc/index.html)

---

layout: true
class: animated fadeIn middle

.footnote[
IPS-DEV - N. Dubray - ENSIIE - 2017
]

---

# Lecturer

## N. Dubray - `noel.dubray@gmail.com`
* *job:* researcher at the CEA (french nuclear agency)
* *field:* theoretical nuclear physics
* *research subject:* microscopic description of the fission process
* *skills:* scientist / developer / HPC user / sysadmin

.hcenter.shadow.w50[![](images/density.png)]

---

# Modules

## :arrow_right: IPS: Introduction to Scientific Programming (S3)
* *IPS.DEV:* Scientific application development
* *IPS.PROD:* Scientific data production, post-processing and visualization

## :arrow_right: PSA: Advanced Scientific Programming (S4)
* *PSA.???:* TBA
* *PSA.???:* TBA

## Evaluation
* project presentation [~10min] + questions [~5min]

## TPs timeline
.mermaid[
    graph LR
    A("Week #1<br/>Initialization") --> B
    B("Week #2<br/>Project") --> C
    C("Week #3<br/>Project") --> D
    D("Week #4<br/>Project") --> E
    E("Week #5<br/>Project") --> F("Week #6<br/>Presentation")
    style F fill:#090
]

---

# These slides

.shadow.hcenter.w20[![](images/github-octocat.png)]

.block.hcenter[
* You can **freely** download, modify and use these slides.
* Do not hesitate to make some **pull requests** if you want to share your modifications.
* Here is the [github repository](http://www.github.com/dubrayn/dubrayn.github.io).
* These slides (and others) can also be [viewed online](http://dubrayn.github.io).
]

---

# GNU/Linux quick howto

## Navigate the filesystem

```shell
$ pwd # get current directory
/tmp
$ mkdir toto      # create directory
$ cd /tmp/toto    # change current directory (absolute path)
$ mkdir tutu
$ cd ..           # change to parent directory (relative path)
$ cd toto/tutu/.. # change with a relative path
$ rmdir tutu      # remove empty directory
```

## Manipulate files

```shell
$ cd /tmp/toto
$ touch example_file # create empty file OR change file modification time
$ ls                 # list files in current directory
example_file
$ cat example_file   # dump file content
$ ls > example_file  # put the result of command ls into file example_file
$ cat example_file   # dump file content
example_file
$ rm example_file            # remove file
$ cp example_file other_file # copy file
```

## Other

```shell
$ ssh user@host # connect to an SSH server
$ man prog      # check the man page for prog
$ which prog    # show the location of prog using PATH env variable
$ ps ux         # list user processes
$ kill PID      # kill a process
$ vim file      # edit a file
```

---

# Scientific method

.noflex[
.rightf.animated.fadeInRight.wait1s.w20[
 ![](images/wikipedia_logo.png)
]

## Usual scheme
1. Define a question
2. Gather information and resources (observe)
3. Form an explanatory hypothesis
4. Test the hypothesis by *performing an experiment* and collecting data in a **reproducible manner**
5. Analyze the data
6. Interpret the data and draw conclusions that serve as a starting point for new hypothesis
7. **Publish results**
8. Retest (frequently done **by other scientists**)

:arrow_right: The scientific code must be shared with **HPC staff and other scientists**.
]

---

# Good development practices

## Make the code **easy to use**
 * Documentation
 * Compilation chain
 * Dependencies
 * Examples
 * Unit tests
 * Efficient code
 * Bindings

## Make the code **easy to read / extend**
 * Documentation (again)
 * Coding style guidelines
 * Well structured source / project
 * Useful comments
 * Versioning

---

# Good development practices

## Make the code **easy to use**
 * Documentation - *documentation generator*
 * Compilation chain - *build system*
 * Dependencies - *build system*
 * Examples - *no tool ?*
 * Unit tests - *unit testing framework*
 * Efficient code - *performance analysis tools*
 * Bindings - *binding generator*

## Make the code **easy to read / extend**
 * Documentation (again) - *documentation generator*
 * Coding style guidelines - *code formatting tool*
 * Well structured source / project - *UML design ?*
 * Useful comments - *commenting conventions*
 * Versioning - *version control system*

---

class: top

# Development tools

## Tools presented in this course
* version control system

--
  * `subversion`, `mercurial`, `CVS`, `SVN`, `Bazaar`, **`git`**

--
* build system

--
  * `Distutils`, `CMake`, `Autotools`, `qmake`, **`GNU Make`**

--
* documentation generator

--
  * `Sphinx`, `Docutils`, **`Doxygen`**

--
* unit testing framework

--
  * `*test*`, **`CxxTest`**

--
* code formatting tool

--
  * **`astyle`**, **`indent`**

--
* commenting conventions
  * various guidelines

--
* performance analysis tools
  * will be presented in PSA (S4)

--
* binding generator
  * will be presented in PSA (S4)

---

# Version control system: `git`

.hcenter.w15[![](images/git_logo.png)]

## History
 * distributed version control system
 * created by **Linus Torvalds** in 2005 as free software (GPL v2)
 * initial goal: become the main VCS (Version Control System) of the **Linux kernel**
 * today: **#1 VCS** :v:

## Characteristics
 * strong support for non-linear development
 * distributed development
 * compatibility with existant systems and protocols
 * efficient handling of large projects
 * cryptographic authentication of history
 * toolkit-based design
 * pluggable merge strategies
 * garbage accumulates until collected
 * periodic explicit object packing

---

# `git` workflow

.mermaid[
    sequenceDiagram
        Remote-->>+Local repo: git clone/pull
        Note over Staged: Empty
        Local repo->>Files: git checkout
        Note over Files: Code...
        Files->>+Staged: git add/rm
        Staged->>-Local repo: git commit
        Note over Files: Code...
        Files->>+Staged: git add/rm
        Staged->>-Local repo: git commit
        Local repo-->>-Remote: git push
]

---

# Creation of a `git` repo from scratch

<div data-dir='scripts/toto4' class='cinescript'></div>

---

# Main `git` commands

## Configure `git` (should be done once)
```shell
$ git config --global user.name "Your Name"
$ git config --global user.email you@yourdomain.example.com
```

## Create a local repo
```shell
$ git init
```

## Clone a remote repo (and create a local repo)
```shell
$ git clone http://some.domain.com/path/to/repo.git
```

## Get documentation
```shell
$ # Example: documentation for command 'git clone'
$ man git-clone
```

---

class: top

# Typical `git` workflow

## 1. clone or create repo
```shell
$ git clone http://some.domain.com/path/to/repo.git
```
--

## 2. make some changes
```shell
$ vim README.md # create new file
$ vim main.cpp  # edit existing file
$ rm toto.h     # remove existing file
```
--

## 3. **stage** changes
```shell
$ git add main.cpp README.md
$ git rm toto.h
```
--

## 4. check staged changes
```shell
$ git diff
$ git status
```
--

## 5. commit staged changes
```shell
$ git commit  # will open an editor to enter the commit message
$ git commit -m "Commit message"
```

---

# `git` history

## View project history (CLI)
```shell
$ git log
$ git log --draw --oneline --color
```

<div data-dir='scripts/toto5' class='cinescript'></div>

---

# GUI tool `gitk`

.hcenter.shadow[![](images/gitk_00.png)]

---

# GUI tool `gitg`

.hcenter.w90.shadow[![](images/gitg.png)]

---

# `git` branches

.row[
.column.middle.w45[
## List branches
```shell
$ git branch
   dev
 * main
```

## Create a branch
```shell
$ git branch dev
```

## Switch to a branch
```shell
$ git checkout dev
```

## Create + switch to a branch
```shell
$ git checkout -b dev
```

## Merge a branch
```shell
$ git merge dev
```

## Delete a branch
```shell
$ git branch -d dev
```
]
.column[
 <canvas id='gitExample0'></canvas>
]
]

---

class: top

# How to use `git` branches

.row[
.column.w45[
* SuperProg :copyright: is in state **v0.2.0**
* you start working on a new functionnality by creating a branch and commiting on it
]

.column[
 <canvas id='branchHowto0'></canvas>
]
]

---

class: top

# How to use `git` branches

.row[
.column.w45[
* SuperProg :copyright: is in state **v0.2.0**
* you start working on a new functionnality by creating a branch and commiting on it
```shell
$ git checkout -b newfunc
$ # some work
$ git commit -m "Commit D"
...
$ # some work
$ git commit -m "Commit F"
```
]

.column[
 <canvas id='branchHowto1'></canvas>
]
]

---

class: top

# How to use `git` branches

.row[
.column.w45[
* SuperProg :copyright: is in state **v0.2.0**
* you start working on a new functionnality by creating a branch and commiting on it
```shell
$ git checkout -b newfunc
$ # some work
$ git commit -m "Commit D"
...
$ # some work
$ git commit -m "Commit F"
```
* :warning: **issue #627 needs to be fixed**
* you create a branch to fix the issue
]

.column[
 <canvas id='branchHowto2'></canvas>
]
]

---

class: top

# How to use `git` branches

.row[
.column.w45[
* SuperProg :copyright: is in state **v0.2.0**
* you start working on a new functionnality by creating a branch and commiting on it
```shell
$ git checkout -b newfunc
$ # some work
$ git commit -m "Commit D"
...
$ # some work
$ git commit -m "Commit F"
```
* :warning: **issue #627 needs to be fixed**
* you create a branch to fix the issue
```shell
$ git checkout master
$ git checkout -b fixit
$ # some work
$ git commit -m "Commit G"
...
$ # some work
$ git commit -m "Fixed issue #627"
```
]

.column[
 <canvas id='branchHowto3'></canvas>
]
]

---

class: top

# How to use `git` branches

.row[
.column.w45[
* SuperProg :copyright: is in state **v0.2.0**
* you start working on a new functionnality by creating a branch and commiting on it
```shell
$ git checkout -b newfunc
$ # some work
$ git commit -m "Commit D"
...
$ # some work
$ git commit -m "Commit F"
```
* :warning: **issue #627 needs to be fixed**
* you create a branch to fix the issue
```shell
$ git checkout master
$ git checkout -b fixit
$ # some work
$ git commit -m "Commit G"
...
$ # some work
$ git commit -m "Fixed issue #627"
```
* you merge your fix in `master`
]

.column[
 <canvas id='branchHowto4'></canvas>
]
]

---

class: top

# How to use `git` branches

.row[
.column.w45[
* SuperProg :copyright: is in state **v0.2.0**
* you start working on a new functionnality by creating a branch and commiting on it
```shell
$ git checkout -b newfunc
$ # some work
$ git commit -m "Commit D"
...
$ # some work
$ git commit -m "Commit F"
```
* :warning: **issue #627 needs to be fixed**
* you create a branch to fix the issue
```shell
$ git checkout master
$ git checkout -b fixit
$ # some work
$ git commit -m "Commit G"
...
$ # some work
$ git commit -m "Fixed issue #627"
```
* you merge your fix in `master`
```shell
$ git checkout master
$ git merge fixit
$ git tag v0.2.1 # lightweight tag
```
]

.column[
 <canvas id='branchHowto5'></canvas>
]
]

---

class: top

# How to use `git` branches

.row[
.column.w45[
* SuperProg :copyright: is in state **v0.2.1**
* you can resume working on the new functionnality
]

.column[
 <canvas id='branchHowto6'></canvas>
]
]

---

class: top

# How to use `git` branches

.row[
.column.w45[
* SuperProg :copyright: is in state **v0.2.1**
* you can resume working on the new functionnality
```shell
$ git checkout newfunc
$ # some work
$ git commit -m "Commit J"
```
* when you are ready, merge the new functionnality in the `master` branch
]

.column[
 <canvas id='branchHowto7'></canvas>
]
]

---

class: top

# How to use `git` branches

.row[
.column.w45[
* SuperProg :copyright: is in state **v0.2.1**
* you can resume working on the new functionnality
```shell
$ git checkout newfunc
$ # some work
$ git commit -m "Commit J"
```
* when you are ready, merge the new functionnality in the `master` branch
```shell
$ git checkout master
$ git merge newfunc
$ git tag v0.3.0
```
]

.column[
 <canvas id='branchHowto8'></canvas>
]
]

---

# Remote repositories

.mermaid.w70.hcenter[
    sequenceDiagram
        Remote-->>+Local repo: git clone/pull
        Local repo->>Files: git checkout
        Note over Files: Code...
        Files->>+Staged: git add/rm
        Staged->>-Local repo: git commit
        Local repo-->>-Remote: git push
]

## Create a bare repo
```shell
$ git init --bare
```

## Declare and sync from a remote repo
```shell
$ git remote add farAway http://some.domain.com/path/to/repo.git
$ git fetch farAway && git merge
$ git pull farAway
```

---

# Conclusions on `git`

.row[
.column.w40.middle[
## To sum up...
* very powerful tool, can be complex sometimes
* **can work offline !**
* rock-solid, very efficient
* **decentralized !**
* several source forges are using it (`github`, `bitbucket`, `gitlab`, etc...)
* learn a few commands and start using it !
* several ways to use it, *follow the guidelines*
* **the de-facto standard CVS**

.hcenter.w50[![](images/git_logo.png)]
]
.column.w55[
<canvas id='gitExample1'></canvas>
]
]


---

# Development tools

## Tools presented in this course
* version control system
  * `subversion`, `mercurial`, `CVS`, `SVN`, `Bazaar`, **`git`** :+:
* build system
  * `Distutils`, `CMake`, `Autotools`, `qmake`, **`GNU Make`**
* documentation generator
  * `Sphinx`, `Docutils`, **`Doxygen`**
* unit testing framework
  * `*test*`, **`CxxTest`**
* code formatting tool
  * **`astyle`**, **`indent`**
* commenting conventions
  * various guidelines
* performance analysis tools
  * will be presented in PSA (S4)
* binding generator
  * will be presented in PSA (S4)

---

# Build system: `GNU Make`

.hcenter.w20[![](images/gnu_logo.png)]

## Key points

* originally created by *Stuart Feldman* in April 1976 at Bell Labs
* part of the `GNU Autotools`
* allows to recompile **only the necessary files**
* has its own language to describe dependencies / actions
* allows a user to build a package **without knowing how it should be done**
* not limited to any particular language
* not limited to building packages
* required for compiling `gcc` since version 3.4.
* required for building the **Linux kernel**, Apache OpenOffice and LibreOffice, Mozilla Firefox...

---

# `GNU Make` workflow

## as a user
```shell
$ make
$ make install
```

## as a dev
```shell
$ # tweak the Makefile...
$ make clean
$ make docs
$ make tests
$ make debug
...
```

---

# Using `GNU Make`

## Makefile
```Makefile
target0: dep0 dep1 dep2
    command0
    command1
```
* a `Makefile` contains a set of rules
* a rule consists of a target, its dependencies, and the commands used to update it
* if not specified, `GNU Make` tries to update the first target of the default file `Makefile`
* for a given target to be updated, `GNU Make` checks which of its dependencies must be updated by checking their modification time
* if a target **does not exist or is older than some of its dependencies**, `GNU Make` tries to update it

----

## Example

.row.hcenter.w50[
.column.w30[
.tree.hcenter[
project
* main.c
* test.c
* test.h
* **Makefile**
]]
.column.w65.middle[
## .hcenter[Makefile]
```makefile
main: main.c main.h
    gcc -o main main.c
```
]]

---

# Writing clean Makefiles 

## Try to...
* use standard variable names (`CC`, `CFLAGS`, `LDFLAGS`, `PREFIX`, `TARGET`...)
* use standard target names (`all`, `install`, `clean`...)
* use generic rules (wildcards)

.row[
.column.w45[
## .hcenter[Makefile]
```Makefile
CC = gcc
CFLAGS = -Wall
TARGET = main
OBJS = main.o

all: $(TARGET)

$(TARGET): $(OBJS)
    $(CC) $(CFLAGS) $^ -o $@

%.o: %.c %.h
    $(CC) $(CFLAGS) $< -c -o $@

.PHONY: clean
clean:
    rm -f $(OBJS)
    rm -f $(TARGET)
```
]

.column.w45[
## .hcenter[Shell session]
```shell
$ make
gcc -Wall main.c -c -o main.o
gcc -Wall main.o -o main
$ make
make: Nothing to be done for `all'.
$ touch main.c
$ make
gcc -Wall main.c -c -o main.o
gcc -Wall main.o -o main
$ touch main.o
$ make
gcc -Wall main.o -o main
$ make clean
rm -f main.o
rm -f main
$ ls
main.c  main.h  Makefile
```
]
]

---

# Makefile wizardry

.row[
.column.w35[
## .hcenter[Makefile]
```Makefile
CC = gcc
CFLAGS = -Wall -O3
LDFLAGS =
TARGET = main
OBJS = main.o

all: $(TARGET)

$(TARGET): $(OBJS)
    $(CC) $(LDFLAGS) $^ -o $@

%.o: %.c %.h
    $(CC) $(CFLAGS) $< -c -o $@

.PHONY: clean
clean:
    rm -f $(OBJS)
    rm -f $(TARGET)
```
]

.column.w60[
## .hcenter[Magic spell]
* replace by internal variable: `$(VAR)`
* replace by env. variable: `${VAR}`
* replace by target: `$@`
* replace by first dependency: `$<`
* replace by dependencies more recent than target: `$?`
* replace by all dependencies: `$^`
* target must always be updated: `.PHONY: target`
* launch `GNU Make` in a given directory: `make -C dir`
.hcenter.w50[![](images/wizard.png)]
]
]

---

# Makefile transformation

.row[
.column.w45[
## .hcenter[Initial Makefile]
```Makefile
main: main.c main.h
    gcc -o main main.c
```
]
.column.w45[
* not easily extendable
* will almost always rebuild everything
* has no standard target names
* not easily tweakable
* etc...
]]

---

# Makefile transformation

.row[
.column.w45[
## .hcenter[Initial Makefile]
```Makefile
main: main.c main.h
    gcc -o main main.c
```
]
.column.w5[:arrow_right:]
.column.w45[
## .hcenter[Add a `clean` target]
```Makefile
main: main.c main.h
    gcc -o main main.c

*.PHONY: clean
*clean:
*   rm -f main
```
]]

---

# Makefile transformation

.row[
.column.w45[
## .hcenter[Add a `clean` target]
```Makefile
main: main.c main.h
    gcc -o main main.c

.PHONY: clean
clean:
    rm -f main
```
]
.column.w5[:arrow_right:]
.column.w45[
## .hcenter[Use variables]
```Makefile
*TARGET = main

*$(TARGET): main.c main.h
*   gcc -o $@ main.c

.PHONY: clean
clean:
*   rm -f $(TARGET)
```
]]

---

# Makefile transformation

.row[
.column.w45[
## .hcenter[Use variables]
```Makefile
TARGET = main

$(TARGET): main.c main.h
    gcc -o $@ main.c

.PHONY: clean
clean:
    rm -f $(TARGET)
```
]
.column.w5[:arrow_right:]
.column.w45[
## .hcenter[Use intermediate objects]
```Makefile
TARGET = main
*OBJS = main.o

*$(TARGET): $(OBJS)
*   gcc -o $@ $^

*%.o: %.cpp %.h
*   gcc -c $<

.PHONY: clean
clean:
*   rm -f $(OBJS)
    rm -f $(TARGET)
```
]]

---

# Makefile transformation

.row[
.column.w45[
## .hcenter[Use intermediate objects]
```Makefile
TARGET = main
OBJS = main.o

$(TARGET): $(OBJS)
    gcc -o $@ $^

%.o: %.c %.h
    gcc -c $<

.PHONY: clean
clean:
    rm -f $(OBJS)
    rm -f $(TARGET)
```
]
.column.w5[:arrow_right:]
.column.w45[
## .hcenter[Add standard variables/targets]
```Makefile
*CC = gcc
*CFLAGS = -Wall -O3
*LDFLAGS =
TARGET = main
OBJS = main.o

*all: $(TARGET)

$(TARGET): $(OBJS)
*   $(CC) $(LDFLAGS) $^ -o $@

%.o: %.c %.h
*   $(CC) $(CFLAGS) $< -c -o $@

.PHONY: clean
clean:
    rm -f $(OBJS)
    rm -f $(TARGET)
```
]]

---

# Recursive Makefiles

.row.hcenter.w70[
.column.w25[
.tree[
project
* src
    * ...
    * **Makefile**
* doc
    * ...
    * Makefile
* Makefile
]]
.column.w70[
## .hcenter[Makefile]
```Makefile
CC = gcc
CFLAGS = -Wall -O3
LDFLAGS =
TARGET = main
OBJS = main.o

all: $(TARGET)

$(TARGET): $(OBJS)
    $(CC) $(LDFLAGS) $^ -o $@

%.o: %.c %.h
    $(CC) $(CFLAGS) $< -c -o $@

.PHONY: clean
clean:
    rm -f $(OBJS)
    rm -f $(TARGET)
```
]]

---

# Recursive Makefiles

.row.hcenter.w70[
.column.w25[
.tree[
project
* src
    * ...
    * Makefile
* doc
    * ...
    * Makefile
* **Makefile**
]]
.column.w70[
## .hcenter[Makefile]
```Makefile
SUBDIRS := doc/. src/.
TARGETS := all clean

# foo/.all bar/.all foo/.clean bar/.clean
SUBDIRS_TARGETS := \
    $(foreach t,$(TARGETS),$(addsuffix $t,$(SUBDIRS)))

.PHONY : $(TARGETS) $(SUBDIRS_TARGETS)

# static pattern rule, expands into:
# all clean : % : foo/.% bar/.%
$(TARGETS) : % : $(addsuffix %,$(SUBDIRS))
    @echo 'Done "$*" target'

# here, for foo/.all:
#   $(@D) is foo
#   $(@F) is .all, with leading period
#   $(@F:.%=%) is just all
$(SUBDIRS_TARGETS) :
    $(MAKE) -C $(@D) $(@F:.%=%)
```
]]

---

# Development tools

## Tools presented in this course
* version control system
  * `subversion`, `mercurial`, `CVS`, `SVN`, `Bazaar`, **`git`** :+:
* build system
  * `Distutils`, `CMake`, `Autotools`, `qmake`, **`GNU Make`** :+:
* documentation generator
  * `Sphinx`, `Docutils`, **`Doxygen`**
* unit testing framework
  * `*test*`, **`CxxTest`**
* code formatting tool
  * **`astyle`**, **`indent`**
* commenting conventions
  * various guidelines
* performance analysis tools
  * will be presented in PSA (S4)
* binding generator
  * will be presented in PSA (S4)

---

# Doxygen

.hcenter.w30[![](images/doxygen_logo.png)]

## Key points

* documentation generator
* supports `C++` (originally), `C`, `C#`, `Objective C`, `Fortran`, `PHP`, `Python`, etc...
* interprets special comments in the source code **and the source code itself**
* generates documentation pages in `HTML`, `\(\LaTeX\)`, `PDF`, etc...
* understands `Markdown` syntax and numerous specific commands

## Main ideas

1. The documentation is **in the code**, so it is easier to keep the code and the documentation **in sync**.
2. Developers are encouraged to document their code in a standardized format **when they write it**.

---

# Example of a documented code

## .hcenter[`test.cpp`]

```C++
/**
 * @file test.cpp
 */

/**
 * A global variable.
 */
int global = 0;

/**
 * A very simple test function.
 *
 * This function is for test purposes only.
 * The returned value should not be used for anything serious.
 * 
 * If you have any remark concerning this function, please append it to the file /dev/null.
 *
 * @param arg0 This is the first argument. It should be ignored.
 * @param arg1 This is the second argument. It should also be ignored.
 * @return The returned value can be used as a neutral element for the addition operation.
 */
double testFunc(int arg0, int arg1)
{
  return 0.0; // Not very useful...
}

```

---

# Generate the documentation

<div data-dir='scripts/toto6' class='cinescript'></div>

---

# Browse the documentation

.shadow.hcenter.w90[![](images/doxygen_example.png)]

.hcenter[
[`HTML` documentation pages](test_doxygen/doc/html/index.html)
]

---

# Configure `Doxygen`

## Tweak the generic configuration file

```shell
$ doxygen -g Doxyfile


Configuration file `Doxyfile' created.

Now edit the configuration file and enter

  doxygen Doxyfile

  to generate the documentation for your project
*$ vim Doxyfile # tweak !!!
$ doxygen
[...]
```

## .hcenter[`Doxyfile` (sample)]

```text
[...]
# This tag specifies the encoding used for all characters in the config file
# that follow. The default is UTF-8 which is also the encoding used for all text
# before the first occurrence of this tag. Doxygen uses libiconv (or the iconv
# built into libc) for the transcoding. See http://www.gnu.org/software/libiconv
# for the list of possible encodings.
# The default value is: UTF-8.

*DOXYFILE_ENCODING      = UTF-8

# The PROJECT_NAME tag is a single word (or a sequence of words surrounded by
# double-quotes, unless you are using Doxywizard) that should identify the
# project for which the documentation is generated. This name is used in the
# title of most generated pages and in a few other places.
# The default value is: My Project.

*PROJECT_NAME           = "My Project"
[...]
```

---

# Configure `Doxygen`

## Use a GUI

```shell
$ doxywizard
```

.shadow.hcenter.w100[![](images/doxywizard.png)]

---

# `Doxygen` output

## .hcenter[`test.cpp`]

```C++
/**
 * @file test.cpp
 */

/**
 * A global variable.
 */
int global = 0;

/**
 * A very simple test function.
 * 
 * This function is for test purposes only.
 * The returned value should not be used for anything serious.
 *  
 * If you have any remark concerning this function, please append it to the file /dev/null.
 * 
 * @param arg0 This is the first argument. It should be ignored.
 * @param arg1 This is the second argument. It should also be ignored.
 * @return The returned value can be used as a neutral element for the addition operation.
 */
double testFunc(int arg0, int arg1)
{
  return 0.0; // Not very useful...
}

*void undocumentedFunc(void)
*{
*  printf("This function is not documented !\n");
*}
```

---

# `Doxygen` output


## Generate documentation
```shell
$ doxygen
[...]
Generating style sheet...
Generating search indices...
Generating example documentation...
Generating file sources...
Generating file documentation...
Generating docs for file test.cpp...
*/home/dubrayn/temp/dubrayn.github.io/IPS-DEV/test_doxygen/test.cpp:27: warning: Member undocumentedFunc(void) (function) of file test.cpp
* is not documented.
Generating page documentation...
Generating group documentation...
Generating class documentation...
Generating namespace index...
Generating graph info page...
Generating directory documentation...
Generating index page...
Generating page index...
Generating module index...
Generating namespace index...
Generating namespace member index...
Generating annotated compound index...
Generating alphabetical compound index...
Generating hierarchical class index...
Generating graphical class hierarchy...
Generating member index...
Generating file index...
Generating file member index...
Generating example index...
[...]
```

---

# `Doxygen` syntax

## Special comment blocks
.row[.w48[
```text
/**
 * ... text ...
 */
```]
.w48[
```text
/*!
 ... text ...
 */
```]]

.row[.w48[
```text
///
///... text ...
///
```]
.w48[
```text
//!
//!... text ...
//!
```]]

.row[.w48[
```text
/********************************************//**
 *  ... text ...
 ***********************************************/
```]
.w48[
```text
/////////////////////////////////////////////////
/// ... text ...
/////////////////////////////////////////////////
```]]

## Brief description

.row[.w48[
```text
/// Brief description.
/** Detailed description. */
```]
.w48[
```text
//! Brief description.

//! Detailed description 
//! starts here.
```]]

## Documentation after declaration

.row[.w48[
```C++
int var; /*!< Detailed description after the member */
```]
.w48[
```C++
int var; ///< Brief description after the member
```]]

---

# Some `Doxygen` commands

## File description

```C++
/*! \file file.h
 * A brief file description.
 * A more elaborated file description.
 */
```

## Class / method / enum / etc... properties

```C++
/*! 
 *  \brief     A trully random class.
 *  \details   This class is used to demonstrate a number of section commands.
 *  \author    John Doe
 *  \author    Jan Doe
 *  \version   3.14a
 *  \date      2015-2017
 *  \pre       First initialize the system.
 *  \bug       Not all memory is freed when deleting an object of this class.
 *  \warning   Improper use can crash your application
 *  \copyright GNU Public License.
 */
class SomeRandomClass {};
```

## Main page

```C++
/*! \mainpage My Personal Index Page
 *
 * \section intro_sec Introduction
 *
 * This is the introduction.
 *
 * \section install_sec Installation
 *
 * \subsection step1 Step 1: Opening the box
 *
 * etc...
 */
```

---

# Development tools

## Tools presented in this course
* version control system
  * `subversion`, `mercurial`, `CVS`, `SVN`, `Bazaar`, **`git`** :+:
* build system
  * `Distutils`, `CMake`, `Autotools`, `qmake`, **`GNU Make`** :+:
* documentation generator
  * `Sphinx`, `Docutils`, **`Doxygen`** :+:
* unit testing framework
  * `*test*`, **`CxxTest`**
* code formatting tool
  * **`astyle`**, **`indent`**
* commenting conventions
  * various guidelines
* performance analysis tools
  * will be presented in PSA (S4)
* binding generator
  * will be presented in PSA (S4)

---

# Unit tests

.hcenter.shadow.w50[![](images/unit_tests_excuses.png)]

---

# `CxxTest`

## Key points

* unit testing framework for `C++`
* very flexible
* semi-automatic test discovery

## .hcenter[`MyTestSuite.h`]
```C++
#include <cxxtest/TestSuite.h>

class MyTestSuite : public CxxTest::TestSuite 
{
  public:
  void testAddition( void )
  {
    TS_ASSERT( 1 + 1 > 1 );
    TS_ASSERT_EQUALS( 1 + 1, 2 );
  }
};
```

```shell
$ cxxtestgen --error-printer -o tests.cpp MyTestSuite.h
$ g++ -o tests tests.cpp
$ ./tests
Running cxxtest tests (1 test).OK!
```

---

# Example of a failed test

## .hcenter[`MyTestSuite2.h`]
```C++
#include <cxxtest/TestSuite.h>

class MyTestSuite2 : public CxxTest::TestSuite
{
public:
    void testAddition(void)
    {
        TS_ASSERT(1 + 1 > 1);
        TS_ASSERT_EQUALS(1 + 1, 2);
    }

    void testMultiplication(void)
    {
        TS_TRACE("Starting multiplication test");
        TS_ASSERT_EQUALS(2 * 2, 5);
        TS_TRACE("Finishing multiplication test");
    }
};
```

```shell
$ cxxtestgen --error-printer -o tests.cpp MyTestSuite.h
$ g++ -o tests tests.cpp
$ ./tests
Running cxxtest tests (2 tests).
In MyTestSuite2::testMultiplication:
/Users/wehart/home/mac/src/cxxtest/doc/examples/MyTestSuite2.h:16: Error: Expected (2 * 2 == 5), found (4 != 5)
Failed 1 and Skipped 0 of 2 tests
Success rate: 50%
```

---

# Main assertions

.hcenter[
| Macro                             | Description                  |
| --------------------------------- | ---------------------------- |
| `TS_ASSERT(expr)`                 | Verify that expr is true     | 
| `TS_ASSERT_DELTA(x,y,d)`          | Verify that abs(x-y) < d     |
| `TS_ASSERT_DIFFERS(x,y)`          | Verify that x != y           |
| `TS_ASSERT_EQUALS(x,y)`           | Verify that x == y           |
| `TS_ASSERT_IS_NAN(x)`             | Verify that x is NaN         |
| `TS_ASSERT_IS_INFINITE(x)`        | Verify that x is infinite    |
| `TS_ASSERT_LESS_THAN(x,y)`        | Verify that x < y            |
| `TS_ASSERT_LESS_THAN_EQUALS(x,y)` | Verify that x ⇐ y            |
| `TS_ASSERT_PREDICATE(P,x)`        | Verify P(x)                  |
| `TS_ASSERT_RELATION(x,R,y)`       | Verify x R y                 |
| `TS_ASSERT_SAME_DATA(x,y,size)`   | Verify two buffers are equal |
]

---

# Exception-related assertions

.hcenter[
| Macro                                         | Description                                          |
| --------------------------------------------- | ---------------------------------------------------- |
| `TS_ASSERT_THROWS(expr,type)`                 | Verify that expr throws the specified exception type |
| `TS_ASSERT_THROWS_ANYTHING(expr)`             | Verify that expr throws an exception                 |
| `TS_ASSERT_THROWS_ASSERT(expr,arg,assertion)` | Verify type and value of what expr throws            |
| `TS_ASSERT_THROWS_EQUALS(expr,arg,x,y)`       | Verify type and value of what expr throws            |
| `TS_ASSERT_THROWS_IS_NAN(expr,arg,x)`         | Verify type and value of what expr throws            |
| `TS_ASSERT_THROWS_IS_INFINITE(expr,arg,x)`    | Verify type and value of what expr throws            |
| `TS_ASSERT_THROWS_NOTHING(expr)`              | Verify that expr doesn’t throw anything              |
]

---

# Special assertions

.hcenter[
| Macro               | Description                               |
| ------------------- | ----------------------------------------- |
| `TS_FAIL(message)`  | Fail unconditionally                      |
| `TS_SKIP(message)`  | Skip this test                            |
| `TS_TRACE(message)` | Print message as an informational message |
| `TS_WARN(message)`  | Print message as a warning                |
]

---

# Mock functions

.block.hcenter[
Testing a code using external functions **without calling these functions**.
]


---

# Development tools

## Tools presented in this course
* version control system
  * `subversion`, `mercurial`, `CVS`, `SVN`, `Bazaar`, **`git`** :+:
* build system
  * `Distutils`, `CMake`, `Autotools`, `qmake`, **`GNU Make`** :+:
* documentation generator
  * `Sphinx`, `Docutils`, **`Doxygen`** :+:
* unit testing framework
  * `*test*`, **`CxxTest`** :+:
* code formatting tool
  * **`astyle`**, **`indent`**
* commenting conventions
  * various guidelines
* performance analysis tools
  * will be presented in PSA (S4)
* binding generator
  * will be presented in PSA (S4)

---

# Armadillo

.hcenter.w30[![](images/armadillo_logo.png)]

## Key points

* [http://arma.sourceforge.net](http://arma.sourceforge.net)
* `C++` linear algebra library
* possible partial front-end for `LAPACK`, `Intel MKL` or `OpenBLAS`
* integer, floating point and complex numbers supported
* vector, matrix, cube objects
* makes your linear algebra routines **clean and efficient**

.block[
## Cite as
Conrad Sanderson and Ryan Curtin.  
[Armadillo: a template-based C++ library for linear algebra.](http://arma.sourceforge.net/armadillo_joss_2016.pdf)  
*Journal of Open Source Software, Vol. 1, pp. 26, 2016.*]

---

# Armadillo example

.row[
.column.w45.middle[
Full code to compute `\(\left[\begin{array}{cc}1&2\\3&4\end{array}\right]*\left[\begin{array}{cc}5&6\\7&8\end{array}\right]^t\)`:
]
.column.w50.middle[
 ```C++
#include <armadillo>

int main()
{
  arma::mat A = {{1, 2}, {3, 4}}; // C++11
  arma::mat B = {{5, 6}, {7, 8}}; // C++11

  ( A * B.t() ).print("result");

  return 0;
}
```
]]

.row[
.column.w45.middle[
Result:
]
.column.w50.middle[
```shell
$ g++ -std=c++11 arma_test.cpp -o arma_test -larmadillo
$ ./arma_test
result
   17.0000   23.0000
   39.0000   53.0000
```
]
]

---

# Manipulate rows/columns

.row[
.column.w50[
.row[
`$$A\equiv\left[\begin{array}{ccc}a_{00}&a_{01}&a_{02}\\a_{10}&a_{11}&a_{12}\\a_{20}&a_{21}&a_{22}\end{array}\right]
=\left[\begin{array}{ccc}1&2&3\\4&5&6\\7&8&9\end{array}\right]$$`
]]
.column.w45.middle[
```C++
arma::mat A = { {1, 2, 3},
                {4, 5, 6},
                {7, 8, 9} }; // C++11
```
]]

----

.row[
.column.w50[
.row[
`$$
B=\left[\begin{array}{ccc}a_{02}&a_{01}&a_{00}\\a_{12}&a_{11}&a_{10}\\a_{22}&a_{21}&a_{20}\end{array}\right]
$$`
]]
.column.w45.middle[
```C++
arma::mat B = A;
B.col(0) = A.col(2);
B.col(1) = A.col(1);
B.col(2) = A.col(0);
```
]]

----

.row[
.column.w50[
.row[
`$$
C=\left[\begin{array}{cccc}a_{00}&a_{01}&a_{02}&10\\a_{10}&a_{11}&a_{12}&11\\a_{20}&a_{21}&a_{22}&12\end{array}\right]
$$`
]]
.column.w45.middle[
```C++
arma::mat C = A;
C.insert_cols(3, arma::colvec({10, 11, 12}));
```
]]

----

.row[
.column.w50[
.row[
`$$
D=\left[\begin{array}{ccc}a_{10}&a_{11}&a_{12}\end{array}\right]
$$`
]]
.column.w45.middle[
```C++
arma::row D = A.row(1);
```
]]

----

.row[
.column.w50[
.row[
`$$
E=\left[\begin{array}{c}a_{20}\\a_{21}\\a_{22}\end{array}\right]
$$`
]
]
.column.w45.middle[
```C++
arma::colvec E = A.col(2);
```
]]

---

# Element-wise functions

.row[
.column.w50[
.row[
`$$A\equiv\left[\begin{array}{ccc}a_{00}&a_{01}&a_{02}\\a_{10}&a_{11}&a_{12}\\a_{20}&a_{21}&a_{22}\end{array}\right]
=\left[\begin{array}{ccc}1&2&3\\4&5&6\\7&8&9\end{array}\right]$$`
]]
.column.w45.middle[
```C++
arma::mat A = { {1, 2, 3},
                {4, 5, 6},
                {7, 8, 9} }; // C++11
```
]]

----

.row[
.column.w50[
.row[
`$$
B=\left[\begin{array}{ccc}e^{a_{00}}&e^{a_{01}}&e^{a_{02}}\\e^{a_{10}}&e^{a_{11}}&e^{a_{12}}\\e^{a_{20}}&e^{a_{21}}&e^{a_{22}}\end{array}\right]
$$`
]
]
.column.w45.middle[
```C++
arma::mat B = arma::exp(A);
```
]]

----

.row[
.column.w50[
.row[
`$$
C=\left[\begin{array}{ccc}a_{00}^3&a_{01}^3&a_{02}^3\\a_{10}^3&a_{11}^3&a_{12}^3\\a_{20}^3&a_{21}^3&a_{22}^3\end{array}\right]
$$`
]
]
.column.w45.middle[
```C++
arma::mat C = arma::pow(A, 3);
```
]]

----

.row[
.column.w50[
.row[
`$$
D=\left[\begin{array}{ccc}a_{00}b_{00}&a_{01}b_{01}&a_{02}b_{02}\\a_{10}b_{10}&a_{11}b_{11}&a_{12}b_{12}\\a_{20}b_{20}&a_{21}b_{21}&a_{22}b_{22}\end{array}\right]
$$`
]
]
.column.w45.middle[
```C++
arma::mat D = A % B;
```
]]

---

# Standard linear algebra operations

.row[
.column.w50[
.row[
`$$A\equiv\left[\begin{array}{ccc}a_{00}&a_{01}&a_{02}\\a_{10}&a_{11}&a_{12}\\a_{20}&a_{21}&a_{22}\end{array}\right]
=\left[\begin{array}{ccc}1&2&3\\4&5&6\\7&8&9\end{array}\right]$$`
]]
.column.w45.middle[
```C++
arma::mat A = { {1, 2, 3},
                {4, 5, 6},
                {7, 8, 9} }; // C++11
```
]]

----

.row[
.column.w50[
.row[
`$$
B=A^{-1}
$$`
]
]
.column.w45.middle[
```C++
arma::mat B = A.i();
```
]]

----

.row[
.column.w50.middle[
 .row[
`$$C = B^t$$`
]]
.column.w45.middle[
```C++
arma::mat C = B.t();
```
]]

----

.row[
.column.w50.middle[
.row[
`$$D = \left(B C^t\right)^{-1}$$`
]]
.column.w45.middle[
```C++
arma::mat D = (B * C.t()).i();
```
]]

----

.row[
.column.w50.middle[
.row[
`$$d_A = \textrm{det}(A)$$`
]]
.column.w45.middle[
```C++
double d_A = arma::det(A);
```
]]

----

.row[
.column.w50.middle[
.row[
Solve `$$AX= EX$$`
]]
.column.w45.middle[
```C++
arma::cx_vec E;
arma::cx_mat X;

arma::eig_gen(E, X, A);
```
]]

---

# Object initialisation

.row[
.column.w50.middle[
.row[
`$$A \equiv \left[\begin{array}{ccc}a_0&a_1&a_2\end{array}\right]
= \left[\begin{array}{cccc}1&2&3\end{array}\right]$$`
]]
.column.w45.middle[
```C++
arma::rowvec A  = {1, 2, 3}; // C++11
```
]]

----

.row[
.column.w50.middle[
.row[
`$$B \equiv \left[\begin{array}{c}b_0\\b_1\\b_2\end{array}\right]
= \left[\begin{array}{c}1\\2\\3\end{array}\right]$$`
]]
.column.w45.middle[
```C++
arma::colvec B = {1, 2, 3, 4}; // C++11
```
]]

----

.row[
.column.w50.middle[
.row[
`$$C = \left[\begin{array}{cc}1&2\\3&4\end{array}\right]$$`
]]
.column.w45.middle[
```C++
arma::mat C = { {1, 2}, {3, 4} }; // C++11
```
]]

----

.row[
.column.w50.middle[
.row[
`$$D = \left[\begin{array}{ccc}a_0&0&0\\0&a_1&0\\0&0&a_2\end{array}\right]$$`
]]
.column.w45.middle[
```C++
arma::mat D = arma::diagmat(A);
```
]]

----

.row[
.column.w50.middle[
.row[
`$$E = \left[\begin{array}{ccc}b_{0}&0&0\\0&b_{1}&0\\0&0&b_{2}\end{array}\right]$$`
]]
.column.w45.middle[
```C++
arma::mat E = arma::diagmat(B);
```
]]

---

# `Armadillo` documentation

:arrow_right: We have only scratched the surface of what `Armadillo` can do.

Mandatory bookmark in your browser:

[http://arma.sourceforge.net/docs.html](http://arma.sourceforge.net/docs.html)

    </textarea>
    <script src="core/javascript/remark.js"></script>
    <script src="core/javascript/MathJax/MathJax.js?config=TeX-AMS-MML_HTMLorMML&delayStartupUntil=configured" type="text/javascript"></script>
    <script src="core/javascript/emojify.js" type="text/javascript"></script>
    <script src="core/javascript/mermaid.js" type="text/javascript"></script>
    <script src="core/javascript/term.js" type="text/javascript"></script>
    <script src="core/javascript/jquery-2.1.1.min.js" type="text/javascript"></script>
    <script src="core/javascript/extend-jquery.js" type="text/javascript"></script>
    <script src="core/javascript/cinescript.js" type="text/javascript"></script>
    <script src="core/javascript/gitgraph.js" type="text/javascript"></script>
    <script>

    // === Remark.js initialization ===
    var slideshow = remark.create({
      highlightStyle: 'monokai',
      countIncrementalSlides: false,
      highlightLines: true,
      highlightInlineCode: false
    });

    // === Mermaid.js initialization ===
    mermaid.initialize({
      startOnLoad: false,
      cloneCssStyles: false,
      flowchart:{
        height: 50
      },
      sequenceDiagram:{
        width: 110,
        height: 30
      }
    });

    function initMermaid(s) {
      var diagrams = document.querySelectorAll('.mermaid');
      var i;
      for(i=0;i<diagrams.length;i++){
        if(diagrams[i].offsetWidth>0){
          mermaid.init(undefined, diagrams[i]);
        }
      }
    }

    slideshow.on('afterShowSlide', initMermaid);
    initMermaid(slideshow.getSlides()[slideshow.getCurrentSlideIndex()]);

    // === MathJax.js initialization ===
    MathJax.Hub.Config({ tex2jax: { skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'] } }); 
    MathJax.Hub.Queue(function() { $(MathJax.Hub.getAllJax()).map(function(index, elem) { return(elem.SourceElement()); }).parent().addClass('has-jax'); });
    MathJax.Hub.Configured();

    // === Emojify.js initialization ===
    emojify.run();

    // === Cinescript initialization ===
    $(document).ready(init_cinescripts);

    </script>
    <script src="gitgraphs.js" type="text/javascript"></script>
  </body>
</html>


