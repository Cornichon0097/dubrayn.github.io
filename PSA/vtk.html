<!DOCTYPE html>
<html>
  <head>
    <title>PSA</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" type="text/css" href="core/fonts/mono.css"> 
    <link rel="stylesheet" type="text/css" href="core/css/animate.css"> 
    <link rel="stylesheet" type="text/css" href="core/css/cinescript.css"> 
    <link rel="stylesheet" type="text/css" href="core/css/style_core.css"> 
    <link rel="stylesheet" type="text/css" href="core/css/mermaid.css"> 
    <link rel="stylesheet" type="text/css" href="core/css/gitgraph.css"> 
    <link rel="stylesheet" type="text/css" href="core/css/style_ensiie.css"> 
  </head>
  <body>
    <textarea id="source" readonly>

layout: true
class: animated fadeIn middle numbers

.footnote[
`PSA` - N. Dubray - ENSIIE - 2018 - [:book:](../index.html)
]

---

# `VTK`

.hcenter.w20[![](images/vtk.png)]

## History
* started in **1993** as companion software for the book *"The Visualization Toolkit: An Object-Oriented Approach to 3D Graphics"* by Will Schroeder, Ken Martin and Bill Lorensen.
* creation of Kitware Inc. in **1998**
* main private contributors: LANL, LLNL, SNL, ARL, NCSA...
* **most used visualization system in the world** (science, industry, medical, big data...)

## Characteristics
* **3177 `C++` classes** (05/14/2018)
* built on top of `OpenGL`
* **multiprocess** and/or **multithread** and/or **`CUDA`** and/or **`OpenCL`**...

.block[
* Repository: [https://gitlab.kitware.com/vtk/vtk](https://gitlab.kitware.com/vtk/vtk)
* Website: [https://www.vtk.org](https://www.vtk.org)
* License: `BSD`
]

---

# `VTK` - Information sources

.vspace[]

.vspace[]

.vspace[]

.noflex[
.rightf.w30[![](images/vtk_book.png)]

## Manuals
* reference manual: [https://www.vtk.org/documentation/](https://www.vtk.org/documentation/)
* local manual pages: package `vtk6-doc` in `ubuntu`

## Examples
* [https://lorensen.github.io/VTKExamples/site/](https://lorensen.github.io/VTKExamples/site/)

## Textbook
* `VTK` Textbook (available in [**free pdf**](https://www.kitware.com/products/books/VTKTextbook.pdf))

## Tutorials
:arrow_right: some of the following slides have been inspired by
* [`VTK` tutorial by Dave Semeraro](http://www.ncsa.illinois.edu/People/semeraro/PPT/VTK_TUTORIAL/v3_document.htm)
]

---

# `VTK` - Library

## Languages
* `VTK` is a library of **object-oriented** classes
* pure `C++` core
* uses a lot of OO-programming techniques
* bindings available for `Tcl`, **`Python`**, and `Java`

## Collaboration diagram for `vtkFieldData`

.vspace[]

.hcenter.w40[![](images/vtk_graph.png)]	

---

# `VTK` - Overview

## Workflow

.hcenter.w60.mermaid.fshadow[
    graph LR
    A(user data) --> B
    B(geometry) --> C(image)
]

## Usual **user data**
* field data on a regular grid
* field data on an irregular grid
* polygonal data
* ...

---

# `VTK` - Models

## `VTK` main parts

:arrow_right: **Graphics Model**
* Abstract layer above OpenGL
* Geometry to Image

:arrow_right: **Visualization Model**
* Visualization **Pipeline**
* Data to Geometry

:arrow_right: **Imaging Model**
* Image processing

---

# `VTK` - Models

## Main Graphics Model Classes
* `vtkRenderWindow`: a usual window, may contain several renderers,
* `vtkRenderer`: an OpenGL context, belongs to a window,
* `vtkActor`: an object rendered in the scene,
* `vtkMapper`: constructs an object from data,
* `vtkCamera`: a camera in the scene,
* `vtkLight`: a light source in the scene,
* `vtkProperty`: appearance of an actor (color, transparency, light properties...),
* `vtkRenderWindowInteractor`: how the user interacts with the scene.

:arrow_right: Some objects may be automatically created by others:  
:bulb: For example, a `vtkRenderer` creates an instance of a `vtkCamera`.

---

# `VTK` - Models

## Visualization Model pipeline

.hcenter.w75.mermaid.fshadow[
    graph LR
    A(source) --> B
    B(filter) --> Y
    C(source) --> D
    D(filter) --> E
    E(filter) --> Y
    Y(filter) --> Z(graphics model)
    style A fill:#2A2
    style C fill:#2A2
    style Z fill:#A22
]

:arrow_right: `Source` objects have 0 input, 1+ output(s)  
:arrow_right: `Filter` objects have 1+ input(s), 1+ output(s)  
:arrow_right: `Mapper` objects have 1+ input(s), 0 output  
:arrow_right: The pipeline implements an **implicit execution** mechanism

 .vspace[]

## Main Visualization Model Classes
* `vtkDataObject`: contains generic data,
* `vtkDataSet`: contains **geometry + topology + attribute data**,
* `vtkProcessObject`: transforms a `vtkDataObject` into another `vtkDataObject`.

---

# `VTK` - Hello world !

## .hcenter[\[vtk/vtk_hello_world.py\]]
```Python
#!/usr/bin/env python

import vtk

# source
cylinder = vtk.vtkCylinderSource()

# mapper
cylinderMapper = vtk.vtkPolyDataMapper()
cylinderMapper.SetInputConnection(cylinder.GetOutputPort())

# actor
cylinderActor = vtk.vtkActor()
cylinderActor.SetMapper(cylinderMapper)
cylinderActor.RotateX(30.0)

# renderer
ren = vtk.vtkRenderer()

# window
renWin = vtk.vtkRenderWindow()
renWin.AddRenderer(ren)

# interactor
iren = vtk.vtkRenderWindowInteractor()
iren.SetRenderWindow(renWin)
iren.Initialize()

# add actor to renderer
ren.AddActor(cylinderActor)

# set window size and render
renWin.SetSize(300, 300)
renWin.Render()

# start interactor loop
iren.Start()
```

---

# `VTK` - Cheatsheet

## Default interactor events

:arrow_right: Keypresses  
* `j` / `t`: toggle between **joystick** or **trackball** modes.
* `c` / `a`: toggle between **camera** or **actor** modes.
* `3`: toggle **stereo** mode.
* `e`: **exit** the application.
* `f`: **fly** to the selected point.
* `p`: select (**pick**) using the current `vtkCellPicker` instance.
* `r`: **reset** the camera.
* `s` / `w`: toggle between **surface** and **wireframe** modes.
* `u`: launch a *user-defined** function.

:arrow_right: Mouse buttons
* `left`: **rotate**.
* `middle`: **translate** (actor) or **pan** (camera).
* `right`: **scale** (actor) or **zoom** (camera).

---

# `VTK` - External data

## `vtkDataObject` conversion and I/O
:arrow_right: `Source` objects produce `vtkDataObject` instances of given types  
:arrow_right: `Filter` objects can **change the type** of a `vtkDataObject`  
:arrow_right: A `Source` object which reads external data is called a **`Reader`**  
:arrow_right: A `Mapper` object which exports data is called a **`Writer`**  

:bulb: Some `Source` objects do not need external data  

.vspace[]

## `vtkDataSet` objects
:arrow_right: Different object types depending on the dataset properties:
* type of the data
* structured / unstructured nature of the data (mesh topology ?)
* (un)regularity of the mesh
* ...

---

# `VTK` - `vtkDataSet` classes

.hcenter.w100.mermaid.fshadow[
    graph RL
    B(vtkHyperTreeGrid) --> A(vtkDataSet)
    A --> Z(vtkDataObject)
    C(vtkImageData) --> A
    D(vtkRectilinearGrid) --> A
    E(vtkPointSet) --> A
    F(vtkStructuredPoints) --> C
    G(vtkUniformGrid) --> C
    H(vtkLabelHierarchy) --> E
    I(vtkPath) --> E
    J(vtkPolyData) --> E
    K(vtkStructuredGrid) --> E
    L(vtkUnstructuredGridBase) --> E
    M(vtkMappedUnstructuredGrid) --> L
    N(vtkUnstructuredGrid) --> L
    style A fill:#2A2
]

---

# `VTK` - File formats

:arrow_right: [Reference document](https://www.vtk.org/wp-content/uploads/2015/04/file-formats.pdf) on `VTK` file formats.

.vspace[]

.hcenter[
| Name              | Extension | Type     | Resulting class       | Structured ? |
| :---------------- | :-------: | :------: | :-------------------- | :----------: |
| ImageData         | `.vti`    | Serial   | `vtkImageData`        | yes          |
| PolyData          | `.vtp`    | Serial   | `vtkPolyData`         | no           |
| RectilinearGrid   | `.vtr`    | Serial   | `vtkRectilinearGrid`  | yes          |
| StructuredGrid    | `.vts`    | Serial   | `vtkStructuredGrid`   | yes          |
| UnstructuredGrid  | `.vtu`    | Serial   | `vtkUnstructuredGrid` | no           |
| PImageData        | `.pvti`   | Parallel | `vtkImageData`        | yes          |
| PPolyData         | `.pvtp`   | Parallel | `vtkPolyData`         | no           |
| PRectilinearGrid  | `.pvtr`   | Parallel | `vtkRectilinearGrid`  | yes          |
| PUnstructuredGrid | `.pvtu`   | Parallel | `vtkUnstructuredGrid` | no           |
| PStructuredGrid   | `.pvts`   | Parallel | `vtkStructuredGrid`   | yes          |
]

## Versions

:arrow_right: For each format, two versions are available: **Legacy** and **`XML`**  
:arrow_right: **Legacy** versions **are easy** to write but slightly verbose  
:arrow_right: **`XML`** versions are **difficult to write** but less (**or more**) verbose  
:bulb: XML versions can be **parallelized**

---

# `VTK` - `vtkDataSet` classes with a corresponding `Reader`

.hcenter.w100.mermaid.fshadow[
    graph RL
    B(vtkHyperTreeGrid) --> A(vtkDataSet)
    A --> Z(vtkDataObject)
    C(vtkImageData) --> A
    D(vtkRectilinearGrid) --> A
    E(vtkPointSet) --> A
    F(vtkStructuredPoints) --> C
    G(vtkUniformGrid) --> C
    H(vtkLabelHierarchy) --> E
    I(vtkPath) --> E
    J(vtkPolyData) --> E
    K(vtkStructuredGrid) --> E
    L(vtkUnstructuredGridBase) --> E
    M(vtkMappedUnstructuredGrid) --> L
    N(vtkUnstructuredGrid) --> L
    style A fill:#2A2
    style C fill:#A22
    style D fill:#A22
    style J fill:#A22
    style K fill:#A22
    style N fill:#A22
]

---

# `VTK`

.noflex[
.rightf.shadow.w30[![](images/salvation.png)]

## `PyEVTK` module

:arrow_right: Allows to **easily** write `VTK` files for the main `vtkDataSet` classes:
* points
* structured grid
* rectilinear grid
* image

:arrow_right: **directly from numpy arrays**  
:arrow_right: **no `VTK` dependency**  
:arrow_right: good performances
]

.block[
* Repository: [https://bitbucket.org/pauloh/pyevtk/src/default/](https://bitbucket.org/pauloh/pyevtk/src/default/)
* License: `GPL`-compatible ?
]

---

# `VTK` - `PyEVTK` supported `vtkDataSet` classes

.hcenter.w100.mermaid.fshadow[
    graph RL
    B(vtkHyperTreeGrid) --> A(vtkDataSet)
    A --> Z(vtkDataObject)
    C(vtkImageData) --> A
    D(vtkRectilinearGrid) --> A
    E(vtkPointSet) --> A
    F(vtkStructuredPoints) --> C
    G(vtkUniformGrid) --> C
    H(vtkLabelHierarchy) --> E
    I(vtkPath) --> E
    J(vtkPolyData) --> E
    K(vtkStructuredGrid) --> E
    L(vtkUnstructuredGridBase) --> E
    M(vtkMappedUnstructuredGrid) --> L
    N(vtkUnstructuredGrid) --> L
    style A fill:#2A2
    style C fill:#A22
    style D fill:#A22
    style J fill:#A22
    style K fill:#A22
]

---

# `VTK`: `PyEVTK` module

## .hcenter[\[vtk/pyevtk_image.py\]]
```Python

```

</textarea>

    <script src="core/javascript/remark.js"></script>
    <script src="core/javascript/plotly.js" type="text/javascript"></script>
    <script src="core/javascript/MathJax/MathJax.js?config=TeX-AMS-MML_HTMLorMML&delayStartupUntil=configured" type="text/javascript"></script>
    <script src="core/javascript/emojify.js" type="text/javascript"></script>
    <script src="core/javascript/mermaid.js" type="text/javascript"></script>
    <script src="core/javascript/term.js" type="text/javascript"></script>
    <script src="core/javascript/jquery-2.1.1.min.js" type="text/javascript"></script>
    <script src="core/javascript/extend-jquery.js" type="text/javascript"></script>
    <script src="core/javascript/cinescript.js" type="text/javascript"></script>
    <script src="core/javascript/gitgraph.js" type="text/javascript"></script>
    <script>

    // === Remark.js initialization ===
    var slideshow = remark.create({
      highlightStyle: 'monokai',
      countIncrementalSlides: false,
      highlightLines: true,
      highlightInlineCode: false
    });

    // === Mermaid.js initialization ===
    mermaid.initialize({
      startOnLoad: false,
      cloneCssStyles: false,
      flowchart:{
        height: 50
      },
      sequenceDiagram:{
        width: 110,
        height: 30
      }
    });

    function initMermaid(s) {
      var diagrams = document.querySelectorAll('.mermaid');
      var i;
      for(i=0;i<diagrams.length;i++){
        if(diagrams[i].offsetWidth>0){
          mermaid.init(undefined, diagrams[i]);
        }
      }
    }

    slideshow.on('afterShowSlide', initMermaid);
    initMermaid(slideshow.getSlides()[slideshow.getCurrentSlideIndex()]);

    // === MathJax.js initialization ===
    MathJax.Hub.Config({ tex2jax: { skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'] } }); 
    MathJax.Hub.Queue(function() { $(MathJax.Hub.getAllJax()).map(function(index, elem) { return(elem.SourceElement()); }).parent().addClass('has-jax'); });
    MathJax.Hub.Configured();

    // === Emojify.js initialization ===
    emojify.run();

    // === Cinescript initialization ===
    $(document).ready(init_cinescripts);

    </script>
  </body>
</html>

